{% extends 'search/base.html' %}

{% load static %}

{% block content %}


<div class="p0header">

  <div class="p0logo">
    <a href="{% url 'search' %}"><img src='{% static 'images/eostree_10.png' %}'></a>
  </div>

  <div class="p0bar">

    <form action="/search" method="get" >
      
        <input type="text" name="q" placeholder="Account / Keyword" value="{{ keyword }}"><button class="p0btn1" type="submit"><img class ="btnimg" src='{% static 'images/search2.png' %}'></button>
    </form>
  </div>

</div>


<div class="p0result">
	<div class="js-bar-container"></div>
</div>



<script src="https://d3js.org/d3.v5.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/britecharts@2/dist/bundled/britecharts.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/britecharts/dist/css/britecharts.min.css">


<script>

// const data = [
//   { name: 'Shiny', id: 1, quantity: 86, percentage: 5 },
//   { name: 'Blazing', id: 2, quantity: 300, percentage: 18 },
//   { name: 'Dazzling', id: 3, quantity: 276, percentage: 16 },
//   { name: 'Radiant', id: 4, quantity: 195, percentage: 11 },
//   { name: 'Sparkling', id: 5, quantity: 36, percentage: 2 },
//   { name: 'Other', id: 0, quantity: 814, percentage: 48 }
// ];



var data = [
{% for key in keyvol %}
    {% if not forloop.first %},{% endif %}
    {
        name: "{{ key.name }}",
        value: "{{ key.value }}",

    }
{% endfor %}
]



let barChart = new britecharts.bar(),

margin = {
        left: 120,
        right: 20,
        top: 20,
        bottom: 30
},

barContainer = d3.select('.js-bar-container'),
containerWidth = barContainer.node() ? barContainer.node().getBoundingClientRect().width : false;

if (barContainer.node()) {
  barChart
	.isHorizontal(true)
	.percentageAxisToMaxRatio(1.3)
	.margin(margin)
	.width(containerWidth)
	.colorSchema(britecharts.colors.colorSchemas.britecharts)
	.valueLabel('value')
    .xTicks(0)
	.height(300);
}

// barChart
//    .isHorizontal(true)
//    .percentageAxisToMaxRatio(1.3)
//    .margin(margin)
//    .width(containerWidth)
//    .colorSchema(britecharts.colors.colorSchemas.britecharts)
//    .valueLabel('quantity')

//    .height(300);

barContainer.datum(data).call(barChart);


const redrawCharts = () => {
    let barContainer = d3.select('.js-bar-container');
    let newContainerWidth = barContainer.node() ? barContainer.node().getBoundingClientRect().width : false;
     
    // Setting the new width on the chart
    barChart.width(newContainerWidth);
 
    // Rendering the chart again
    barContainer.datum(data).call(barChart);
};

const throttledRedraw =  _.throttle(redrawCharts, 200);  
 
window.addEventListener('resize', throttledRedraw);



</script>







{% endblock %}

